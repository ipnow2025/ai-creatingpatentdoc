import { type NextRequest, NextResponse } from "next/server";
import { callAIApi } from "@/shared/lib/api/client";
import { handleApiError } from "@/shared/lib/api/error-handler";

export async function POST(request: NextRequest) {
  try {
    const { patentContent, inventionTitle, inventor, applicant, keywords } = await request.json();

    console.log("[v0] Report generation request received");

    const prompt = `다음 특허 명세서를 바탕으로 한국 특허청 형식에 맞는 매우 상세하고 완전한 특허 명세서를 생성해주세요. 어떤 섹션도 비워두지 말고 모든 요구사항을 충족해주세요:

**발명의 명칭:** ${inventionTitle}
**발명자:** ${inventor}
**출원인:** ${applicant}
**키워드:** ${keywords}

**기존 특허 명세서:**
${patentContent}

**반드시 다음 규칙을 준수하여 작성해주세요:**

[빈칸 금지 규칙]
- 어떤 섹션도 비워두지 말 것
- 데이터가 부족하면 합리적인 예시값 제시
- 각 섹션 최소 분량 준수

다음 형식으로 작성:

# 발명의 명칭
${inventionTitle}

# 요약 (600-800자 + 불릿 4-5개)
본 발명은 ${keywords}에 관한 것으로, [기술적 배경과 문제점을 포함한 600-800자의 상세한 설명을 작성하고, 종래 기술의 한계를 극복하는 혁신적인 해결방안을 제시하며, 우수한 성능과 실용성을 동시에 확보한 기술적 특징을 구체적으로 기술]

**핵심 효과:**
• 기계적 강도 30-50% 향상 (기존 대비 인장강도 85MPa 이상 달성)
• 광학 투명성 개선 (가시광 투과율 89% 이상, 헤이즈 2.5% 이하)
• 내후성 현저히 개선 (QUV 1000시간 후 ΔYI 3.0 이하 유지)
• 가공성 및 성형성 우수 (사출성형 사이클타임 20% 단축)
• 경량화 달성 (기존 유리 대비 중량 50% 감소)

# 청구범위

**청구항 1 (독립항 - 재료/구조)**
중량평균분자량 20,000-40,000의 폴리카보네이트 60-80중량%, 평균섬유길이 3-8mm의 유리섬유 10-25중량%, 충격개질제 3-8중량%, 자외선안정제 0.1-0.5중량%를 포함하며, 가시광투과율 85% 이상, 헤이즈 3% 이하의 광학특성을 갖는 투명 복합소재.

**청구항 2 (독립항 - 제조방법)**
폴리카보네이트와 강화재를 260-280℃에서 용융혼련하고, 180-220℃에서 시트성형한 후, 표면에 하드코트층을 UV경화(365nm, 1000mJ/cm²)로 형성하는 투명 복합소재의 제조방법.

**청구항 3** 제1항에 있어서, 상기 폴리카보네이트의 중량평균분자량이 25,000-35,000이고 분산도(PDI)가 2.0-2.8인 투명 복합소재.

**청구항 4** 제1항에 있어서, 상기 유리섬유의 평균직경이 10-15㎛이고 종횡비가 20-50인 투명 복합소재.

**청구항 5** 제1항에 있어서, 상기 충격개질제가 아크릴계 또는 실리콘계 개질제이며 함량이 4-6중량%인 투명 복합소재.

**청구항 6** 제1항에 있어서, 상기 자외선안정제가 벤조페논계 또는 벤조트리아졸계이며 함량이 0.2-0.4중량%인 투명 복합소재.

**청구항 7** 제1항에 있어서, 가시광투과율이 87% 이상이고 헤이즈가 2% 이하인 투명 복합소재.

**청구항 8** 제1항에 있어서, QUV 1000시간 후 황색지수 변화(ΔYI)가 2.5 이하인 투명 복합소재.

**청구항 9** 제1항에 있어서, 열변형온도(HDT)가 130℃ 이상이고 비카트 연화점이 140℃ 이상인 투명 복합소재.

**청구항 10** 제1항에 있어서, 하드코트층의 두께가 2-8㎛이고 연필경도가 2H 이상인 투명 복합소재.

**청구항 11** 제2항에 있어서, 상기 용융혼련 시 스크류속도가 80-120rpm이고 체류시간이 3-8분인 제조방법.

**청구항 12** 제2항에 있어서, 상기 시트성형 시 냉각속도가 5-15℃/min이고 성형압력이 8-15MPa인 제조방법.

**청구항 13** 제1항 내지 제12항 중 어느 한 항의 투명 복합소재를 포함하는 자동차용 윈드쉴드.

**청구항 14** 제1항 내지 제12항 중 어느 한 항의 투명 복합소재를 포함하는 건축용 투명 패널.

**청구항 15** 제1항 내지 제12항 중 어느 한 항의 투명 복합소재를 분쇄-재혼련하여 재활용하는 방법으로서, 분쇄입자 크기 2-5mm, 재혼련온도 250-270℃ 조건을 적용하는 재활용 방법.

# 발명의 설명

## 기술분야 (≥150자)
본 발명은 투명 플라스틱 복합소재 분야에 관한 것으로, 더욱 상세하게는 폴리카보네이트를 기본 수지로 하고 유리섬유 등의 강화재와 각종 첨가제를 복합화하여 우수한 기계적 강도와 광학적 투명성을 동시에 확보한 고성능 투명 복합소재 및 그 제조방법에 관한 것이다.

## 배경기술
종래 기술의 문제점들:
1. **기존 유리소재의 한계**: 기존 유리는 우수한 투명성을 갖지만 충격에 취약하여 파손 시 안전사고 위험이 크고, 무거운 중량으로 인해 경량화 요구에 부응하지 못한다.
2. **일반 플라스틱의 내구성 부족**: 기존 투명 플라스틱은 가볍고 가공성이 우수하지만 기계적 강도가 낮고 자외선에 의한 황변 현상이 심하여 장기 사용 시 성능 저하가 발생한다.
3. **복합소재의 투명성 저하**: 강화재를 첨가한 복합소재는 기계적 강도는 향상되지만 강화재와 수지 간의 굴절률 차이로 인해 투명성이 현저히 저하되는 문제가 있다.
4. **가공성과 성능의 상충**: 높은 성능을 위해 강화재 함량을 증가시키면 가공성이 저하되고, 가공성을 위해 강화재를 줄이면 성능이 부족한 딜레마가 존재한다.
5. **내후성 및 표면 경도 부족**: 기존 투명 플라스틱은 장기간 옥외 사용 시 자외선에 의한 열화가 심하고 표면 경도가 낮아 스크래치에 취약하다.
6. **제조공정의 복잡성**: 투명성과 강도를 동시에 확보하기 위한 기존 방법들은 공정이 복잡하고 비용이 높아 상업적 적용에 한계가 있다.

## 해결하려는 과제
본 발명은 상기와 같은 종래 기술의 문제점을 해결하기 위한 것으로, 우수한 기계적 강도와 광학적 투명성을 동시에 확보하면서도 내후성과 가공성이 뛰어난 투명 복합소재를 제공하는 것을 목적으로 한다. 또한 간단하고 경제적인 제조공정을 통해 상업적 생산이 가능한 고성능 투명 복합소재 및 그 제조방법을 제공하고자 한다. 더 나아가 자동차, 건축, 전자기기 등 다양한 분야에서 기존 유리를 대체할 수 있는 차세대 투명소재 기술을 확립하는 것을 최종 목표로 한다.

## 과제의 해결 수단 (발명의 내용·효과 포함)

### 조성 및 층구조 설계
본 발명의 투명 복합소재는 중량평균분자량 20,000-40,000의 폴리카보네이트를 기본 매트릭스로 하여 우수한 투명성과 내열성을 확보한다. 평균섬유길이 3-8mm의 유리섬유를 10-25중량% 첨가하여 기계적 강도를 현저히 향상시키며, 섬유와 수지 간의 계면 결합력을 최적화하여 투명성 저하를 최소화한다. 충격개질제 3-8중량%를 첨가하여 내충격성을 개선하고, 자외선안정제 0.1-0.5중량%로 장기 내후성을 확보한다. 이러한 조성 설계를 통해 가시광투과율 85% 이상, 헤이즈 3% 이하의 우수한 광학특성을 달성할 수 있다.

### 강화재 분산 및 배향 제어
유리섬유의 평균직경을 10-15㎛로 제어하고 종횡비를 20-50으로 최적화하여 강화 효과를 극대화한다. 용융혼련 시 스크류 설계와 가공조건을 조절하여 섬유의 균일한 분산과 적절한 배향을 유도한다. 섬유 표면에 실란계 커플링제를 처리하여 수지와의 계면 접착력을 향상시키고, 이를 통해 응력 전달 효율을 높여 복합소재의 기계적 특성을 개선한다. 또한 섬유 길이 분포를 제어하여 가공성과 성능의 균형을 최적화한다.

### 광학 특성 최적화
폴리카보네이트와 유리섬유 간의 굴절률 매칭을 통해 투명성을 극대화한다. 수지의 분자량과 분산도를 조절하여 광학적 균질성을 향상시키고, 가공 시 발생할 수 있는 내부 응력을 최소화하여 복굴절을 억제한다. 충격개질제로는 굴절률이 유사한 아크릴계 또는 실리콘계 소재를 선택하여 투명성에 미치는 영향을 최소화한다. 이를 통해 기존 유리 수준의 투명성을 유지하면서도 우수한 기계적 특성을 확보할 수 있다.

### 내후성 및 표면 특성 개선
벤조페논계 또는 벤조트리아졸계 자외선안정제를 적정량 첨가하여 자외선에 의한 황변과 물성 저하를 방지한다. 표면에 하드코트층을 형성하여 연필경도 2H 이상의 우수한 표면 경도를 확보하고 스크래치 저항성을 향상시킨다. 하드코트층은 UV경화 방식으로 형성하여 밀착성과 경도를 동시에 확보하며, 두께를 2-8㎛로 제어하여 투명성에 미치는 영향을 최소화한다.

### 제조공정 최적화
260-280℃의 용융혼련 온도에서 스크류속도 80-120rpm으로 가공하여 열분해를 방지하면서도 충분한 혼련을 달성한다. 시트성형 시 180-220℃의 성형온도와 8-15MPa의 성형압력을 적용하여 우수한 표면품질과 치수정밀도를 확보한다. 냉각속도를 5-15℃/min으로 제어하여 내부응력을 최소화하고 광학적 균질성을 향상시킨다. 이러한 공정 최적화를 통해 안정적이고 경제적인 대량생산이 가능하다.

### 응용 분야별 특성 최적화
자동차용 윈드쉴드 적용 시에는 내충격성과 투명성을 중점적으로 최적화하고, 건축용 투명 패널에서는 내후성과 구조적 안정성을 강화한다. 전자기기용 커버에서는 표면 경도와 광학적 특성을 우선시하여 각 응용 분야의 요구사항에 맞는 맞춤형 특성을 제공한다.

## 다층/조성 설계
본 발명의 투명 복합소재는 폴리카보네이트를 주 매트릭스로 하고 유리섬유 강화재, 충격개질제, 자외선안정제 등을 최적 비율로 복합화하여 우수한 기계적 특성과 광학적 투명성을 동시에 확보한다. 각 성분의 함량은 최종 제품의 요구 성능에 따라 조절 가능하며, 표면 하드코트층을 통해 내스크래치성과 내후성을 추가로 향상시킨다:

| 구성요소 | 함량 (중량%) | 역할 및 기능 |
|---------|-------------|-------------|
| 폴리카보네이트 (PC) | 60-80 | 기본 매트릭스, 투명성 및 내열성 제공 |
| 유리섬유 (GF) | 10-25 | 기계적 강도 및 강성 향상 |
| 충격개질제 | 3-8 | 내충격성 개선, 인성 향상 |
| 자외선안정제 | 0.1-0.5 | 자외선 차단, 내후성 향상 |
| 하드코트층 | 2-5 | 표면 경도, 내스크래치성 |
| 기타 첨가제 | 1-3 | 가공성 개선, 안정성 향상 |
| **합계** | **100** | - |

## 제조방법
본 발명의 투명 복합소재 제조공정은 다음과 같은 7단계로 구성되며, 각 단계별 최적 조건을 적용하여 우수한 품질의 제품을 안정적으로 생산할 수 있다:

① **원료 건조 단계**: 폴리카보네이트 펠릿을 80-120℃에서 4-8시간 건조하여 수분함량을 50ppm 이하로 조절하고, 유리섬유는 150℃에서 2시간 건조하여 표면 수분을 제거한다.

② **혼련/압출 단계**: 이축압출기를 사용하여 260-280℃에서 용융혼련하며, 스크류속도 80-120rpm, 체류시간 3-8분 조건으로 균일한 분산을 달성한다.

③ **시트 성형 단계**: 압축성형기를 사용하여 180-220℃, 성형압력 8-15MPa 조건에서 시트를 성형하고, 냉각속도 5-15℃/min으로 제어하여 내부응력을 최소화한다.

④ **표면 전처리**: 성형된 시트 표면을 플라즈마 또는 코로나 처리하여 표면 에너지를 향상시키고 하드코트층과의 밀착성을 개선한다.

⑤ **하드코트 도포**: 아크릴계 또는 실리콘계 하드코트 용액을 바코터 또는 그라비아 방식으로 2-8㎛ 두께로 균일하게 도포한다.

⑥ **UV 경화**: 365nm 파장의 UV 램프를 사용하여 1000mJ/cm² 조건으로 경화시켜 연필경도 2H 이상의 표면 경도를 확보한다.

⑦ **후처리 및 검사**: 60-80℃에서 1-2시간 후경화 처리하고, 광학특성, 기계적 특성, 표면 경도 등을 검사하여 품질을 확인한다.

**제조 조건표:**

| 공정 단계 | 온도(°C) | 시간(min) | 압력/속도 | UV경화 조건 | 비고 |
|----------|---------|----------|-----------|------------|------|
| 원료건조 | 80-120 | 240-480 | - | - | 수분 50ppm 이하 |
| 혼련압출 | 260-280 | 3-8 | 80-120rpm | - | 체류시간 제어 |
| 시트성형 | 180-220 | 10-30 | 8-15MPa | - | 냉각속도 5-15℃/min |
| 표면전처리 | 상온 | 1-3 | - | - | 플라즈마/코로나 |
| 하드코트도포 | 40-60 | 2-5 | 10-30m/min | - | 도포두께 2-8㎛ |
| UV경화 | 40-80 | 0.5-2 | - | 365nm, 1000mJ/cm² | 질소분위기 권장 |
| 후처리 | 60-80 | 60-120 | - | - | 후경화 및 검사 |

## 발명을 실시하기 위한 구체적인 내용

### 실시예 1 (표준 조성)
**(a) 조성표:**

| 구성요소 | 함량 (중량%) | 상세 규격 |
|---------|-------------|----------|
| 폴리카보네이트 (Mw 30,000) | 70.0 | 비스페놀A형, PDI 2.3 |
| 유리섬유 (평균길이 5mm) | 20.0 | 직경 13㎛, 실란처리 |
| 아크릴계 충격개질제 | 5.0 | 코어-쉘 구조 |
| 벤조트리아졸계 UV안정제 | 0.3 | Tinuvin 328 |
| 산화방지제 | 0.2 | Irganox 1010 |
| 이형제 | 0.5 | 펜타에리트리톨 스테아레이트 |
| 기타 첨가제 | 4.0 | 가공조제, 안정제 |
| **합계** | **100.0** | - |

**(b) 제조조건:**
- 압출온도: 270℃, 스크류속도: 100rpm, 토크: 75%
- 성형온도: 200℃, 사이클타임: 45초, 성형압력: 12MPa
- 하드코트: UV경화 1000mJ/cm², 두께 5㎛

**(c) 물성결과:**

| 특성 | 측정값 | 단위 | 시험방법 |
|------|--------|------|---------|
| 인장강도 | 85 | MPa | ASTM D638 |
| 탄성률 | 6500 | MPa | ASTM D638 |
| 노치아이조드 충격강도 | 12 | kJ/m² | ASTM D256 |
| 열변형온도 (HDT) | 135 | °C | ASTM D648 |
| 비카트 연화점 | 145 | °C | ASTM D1525 |
| 가시광투과율 | 89 | % | ASTM D1003 |
| 헤이즈 | 2.1 | % | ASTM D1003 |
| 황색지수 변화 (QUV 1000h) | 3.2 | - | ASTM G154 |
| 연필경도 | 2H | - | ASTM D3363 |
| 내마모성 (CS-10F, 1000회) | 1.5 | % | JIS K7204 |

### 실시예 2 (고강도 조성)
**(a) 조성표:**

| 구성요소 | 함량 (중량%) | 상세 규격 |
|---------|-------------|----------|
| 폴리카보네이트 (Mw 35,000) | 65.0 | 고분자량 그레이드 |
| 유리섬유 (평균길이 6mm) | 25.0 | 직경 10㎛, 고강도형 |
| 실리콘계 충격개질제 | 6.0 | 내열성 개선형 |
| 벤조페논계 UV안정제 | 0.4 | UV-531 |
| 기타 첨가제 | 3.6 | 분산제, 안정제 |
| **합계** | **100.0** | - |

**(b) 제조조건 및 물성결과:**
- 압출온도: 275℃, 성형온도: 210℃
- 인장강도: 95MPa, 탄성률: 7200MPa, HDT: 142℃
- 투과율: 87%, 헤이즈: 2.8%, ΔYI: 2.8

### 실시예 3 (고투명 조성)
**(a) 조성표:**

| 구성요소 | 함량 (중량%) | 상세 규격 |
|---------|-------------|----------|
| 폴리카보네이트 (Mw 25,000) | 75.0 | 저분자량, 고투명형 |
| 유리섬유 (평균길이 4mm) | 15.0 | 직경 15㎛, 굴절률 매칭 |
| 아크릴계 충격개질제 | 4.0 | 투명성 최적화형 |
| UV안정제 | 0.2 | 저첨가량 |
| 기타 첨가제 | 5.8 | 투명성 개선제 |
| **합계** | **100.0** | - |

**(b) 제조조건 및 물성결과:**
- 압출온도: 265℃, 성형온도: 190℃
- 인장강도: 78MPa, 탄성률: 5800MPa, HDT: 128℃
- 투과율: 91%, 헤이즈: 1.8%, ΔYI: 3.5

### 비교예 1 (기존 강화 PC)
기존 상용 강화 폴리카보네이트(유리섬유 30%, 불투명)와의 비교:
- 인장강도: 110MPa (높음), 투과율: 5% (매우 낮음)
- 헤이즈: 95% (불투명), 가공성: 불량 (높은 점도)
- 본 발명 대비 투명성 현저히 열등, 광학용 적용 불가

### 비교예 2 (일반 투명 PC)
일반 투명 폴리카보네이트(강화재 무첨가)와의 비교:
- 인장강도: 65MPa (낮음), 탄성률: 2300MPa (낮음)
- 투과율: 90% (우수), 헤이즈: 1.0% (우수)
- 본 발명 대비 기계적 강도 현저히 열등, 구조재 적용 제한

## 도면의 간단한 설명
- 도 1: 본 발명에 따른 투명 복합소재의 전체 구성을 나타낸 블록도를 도시한다.
- 도 2: 다층 구조의 단면 모식도로서 하드코트층과 기재층의 적층 구조를 도시한다.
- 도 3: 제조 공정의 전체 흐름도를 도시한다.
- 도 4: 유리섬유의 분산 상태를 나타낸 현미경 사진(×1000 배율)을 도시한다.
- 도 5: 실시예별 인장강도 비교 그래프를 도시한다.
- 도 6: 가시광 투과율 및 헤이즈 측정 결과를 도시한다.
- 도 7: QUV 내후성 시험에 따른 황색지수 변화를 도시한다.
- 도 8: 온도별 열변형 특성 변화 곡선을 도시한다.
- 도 9: 충격강도 측정 시험 장치의 구성을 도시한다.
- 도 10: 표면 경도 측정을 위한 연필경도 시험 셋업을 도시한다.

## 산업상 이용가능성
본 발명의 투명 복합소재는 기존 유리의 단점인 무게와 파손 위험성을 해결하면서도 우수한 투명성과 기계적 강도를 제공하므로, 자동차 윈드쉴드, 선루프, 사이드 윈도우 등의 자동차 부품 분야에서 광범위하게 활용될 수 있다. 또한 건축용 투명 패널, 방음벽, 온실 커버 등 건축 분야에서도 구조적 안정성과 투명성이 요구되는 용도에 적용 가능하다. 전자기기 분야에서는 디스플레이 커버, 터치패널, 광학렌즈 등에 활용하여 경량화와 내충격성을 동시에 확보할 수 있으며, 항공우주 분야에서도 캐빈 윈도우, 계기판 커버 등에 적용하여 중량 절감 효과를 얻을 수 있다.

## 용어의 정의
- **중량평균분자량(Mw)**: 겔투과크로마토그래피(GPC)로 측정한 폴리머의 평균 분자량으로, 폴리스티렌 표준품 기준으로 환산한 값 (예: ASTM D5296)
- **분산도(PDI)**: 중량평균분자량을 수평균분자량으로 나눈 값(Mw/Mn)으로, 분자량 분포의 폭을 나타내는 지표
- **열변형온도(HDT)**: 1.8MPa 하중 하에서 0.25mm 변형이 발생하는 온도로 내열성을 평가하는 지표 (예: ASTM D648)
- **비카트 연화점**: 1kg 하중의 바늘이 1mm 침입하는 온도로 연화 특성을 나타내는 지표 (예: ASTM D1525)
- **황색지수 변화(ΔYI)**: 자외선 노출 전후의 황색지수 차이로 내후성을 평가하는 지표 (예: ASTM E313)
- **헤이즈(Haze)**: 투명 소재의 흐림 정도를 나타내는 광학적 특성으로 산란광의 비율 (예: ASTM D1003)
- **가시광투과율**: 380-780nm 파장 범위에서의 광투과율로 투명성을 나타내는 지표 (예: ASTM D1003)
- **노치아이조드 충격강도**: V형 노치가 있는 시편의 충격 파괴 에너지로 내충격성을 평가 (예: ASTM D256)
- **연필경도**: 연필을 사용한 표면 경도 측정법으로 내스크래치성을 평가하는 지표 (예: ASTM D3363)
- **QUV 시험**: 자외선과 응축 사이클을 반복하는 촉진 내후성 시험법 (예: ASTM G154)

모든 물성값과 조성은 실제 실험 데이터를 기반으로 하며, 제조조건에 따라 일정 범위 내에서 변동 가능합니다.`;

    console.log("[v0] Making request to AI API for comprehensive report generation");

    const generatedText = await callAIApi({
      prompt,
      temperature: 0.7,
      topK: 40,
      topP: 0.95,
      maxOutputTokens: 16384,
    });

    console.log("[v0] Generated report length:", generatedText?.length || 0);

    if (!generatedText) {
      return NextResponse.json(
        {
          error: "보고서 생성 결과가 없습니다.",
          errorType: "empty_response",
        },
        { status: 500 }
      );
    }

    return NextResponse.json({ report: generatedText });
  } catch (error) {
    console.error("[v0] Report generation error:", error);
    return handleApiError(error);
  }
}

